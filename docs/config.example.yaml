# =============================================================================
# kkcode 完整配置参考
# =============================================================================
# 配置文件加载优先级：项目配置 > 用户配置 > 默认配置
#
# 配置文件位置：
#   用户级：~/.config/kkcode/config.yaml
#   项目级：.kkcode/config.yaml 或项目根目录 kkcode.yaml
#
# 支持格式：YAML (.yaml/.yml) 和 JSON (.json)
# =============================================================================

# =============================================================================
# 模型提供者配置
# =============================================================================
provider:
  default: "dashscope"
  strict_mode: false

  # --- OpenAI ---
  openai:
    type: "openai"
    api_key_env: "OPENAI_API_KEY"
    default_model: "gpt-5.3-codex"
    models: [gpt-5.3-codex, gpt-5.2]
    timeout_ms: 120000
    stream_idle_timeout_ms: 120000
    max_tokens: 32768
    retry_attempts: 3
    retry_base_delay_ms: 800
    stream: true

  # --- Anthropic ---
  anthropic:
    type: "anthropic"
    api_key_env: "ANTHROPIC_API_KEY"
    default_model: "claude-sonnet-4-6"
    models: [claude-opus-4-6, claude-sonnet-4-6, claude-sonnet-4-5, claude-haiku-4-5-20251001]
    timeout_ms: 120000
    max_tokens: 32768
    retry_attempts: 3
    stream: true

  # --- DashScope（通义千问 Qwen 系列）---
  dashscope:
    type: "openai-compatible"
    base_url: "https://dashscope.aliyuncs.com/compatible-mode/v1"
    # 海外用户: https://dashscope-intl.aliyuncs.com/compatible-mode/v1
    api_key_env: "DASHSCOPE_API_KEY"
    default_model: "qwen3.5-plus-latest"
    models:
      - qwen3.5-plus-latest
      - qwen3.5-plus
      - qwen3-max
      - qwen3-coder-plus
      - qwen3-coder-flash
      - qwen-max
      - qwen-plus
    timeout_ms: 120000
    max_tokens: 32768
    retry_attempts: 3
    stream: true

  # --- 智谱 GLM ---
  zhipu:
    type: "openai-compatible"
    base_url: "https://open.bigmodel.cn/api/paas/v4"
    # 海外用户: https://api.z.ai/api/paas/v4
    api_key_env: "ZHIPU_API_KEY"
    default_model: "glm-5"
    models: [glm-5, glm-4.5, glm-4.5-air]
    timeout_ms: 120000
    max_tokens: 32768
    retry_attempts: 3
    stream: true

  # --- DeepSeek ---
  deepseek:
    type: "openai-compatible"
    base_url: "https://api.deepseek.com"
    api_key_env: "DEEPSEEK_API_KEY"
    default_model: "deepseek-chat"
    models: [deepseek-chat, deepseek-reasoner]
    timeout_ms: 120000
    max_tokens: 32768
    retry_attempts: 3
    stream: true

  # --- 本地 Ollama ---
  ollama:
    type: "ollama"
    base_url: "http://localhost:11434"
    api_key_env: ""
    default_model: "qwen3:32b"
    timeout_ms: 600000
    stream_idle_timeout_ms: 300000
    max_tokens: 16384
    retry_attempts: 1
    stream: true

# =============================================================================
# Agent 配置
# =============================================================================
agent:
  default_mode: "agent"       # ask | plan | agent | longagent
  max_steps: 50

  longagent:
    max_iterations: 30
    no_progress_warning: 3
    no_progress_limit: 5
    heartbeat_timeout_ms: 120000
    checkpoint_interval: 5

    parallel:
      enabled: true
      max_concurrency: 3
      stage_pass_rule: "all_success"
      task_timeout_ms: 600000
      task_max_retries: 2

    hybrid:
      enabled: true
      intake: true
      completion_validation: true
      tdd_mode: false
      cross_review: true
      incremental_gates: true

    git:
      enabled: "ask"          # true | false | "ask"
      auto_branch: true
      auto_commit_stages: true
      auto_merge: true

# =============================================================================
# 权限配置（详见 configs/permission-*.yaml 模板）
# =============================================================================
permission:
  default_policy: "ask"       # allow | ask | deny
  non_tty_default: "deny"     # allow | allow_once | deny
  rules:
    - tool: read
      action: allow
    - tool: glob
      action: allow
    - tool: grep
      action: allow
    - tool: list
      action: allow

# =============================================================================
# Git 自动化配置
# =============================================================================
git_auto:
  enabled: true
  auto_snapshot: true
  max_snapshots: 50
  ttl_days: 7
  forbid_commit: true
  forbid_push: true
  full_auto: false

# =============================================================================
# 会话配置
# =============================================================================
session:
  max_history: 30
  recovery: true
  compaction_threshold_ratio: 0.7
  compaction_threshold_messages: 50
  context_cache_points: true

# =============================================================================
# 工具配置
# =============================================================================
tool:
  sources:
    builtin: true
    local: true
    mcp: true
    plugin: true
  bash_timeout_ms: 120000
  write_lock:
    mode: "file_lock"
    wait_timeout_ms: 120000

# =============================================================================
# 使用量与预算
# =============================================================================
usage:
  budget:
    session_usd: null
    global_usd: null
    warn_at_percent: 80
    strategy: "warn"          # warn | block

# =============================================================================
# UI 配置
# =============================================================================
ui:
  layout: "compact"           # compact | comfortable
  markdown_render: true
  mode_colors:
    ask: "#8da3b9"
    plan: "#00b7c2"
    agent: "#2ac26f"
    longagent: "#ff7a33"
  status:
    show_cost: true
    show_token_meter: true
